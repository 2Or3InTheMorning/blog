(window.webpackJsonp=window.webpackJsonp||[]).push([[176],{725:function(t,a,e){"use strict";e.r(a);var v=e(43),s=Object(v.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"web-vitals"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-vitals"}},[t._v("#")]),t._v(" Web Vitals")]),t._v(" "),e("blockquote",[e("p",[t._v("Web Vitals是谷歌提出的一组用来衡量 用户体验 的度量指标集。")]),t._v(" "),e("p",[t._v("标准来自：W3C Web Performance Working Group")])]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#web-vitals"}},[t._v("Web Vitals")]),e("ul",[e("li",[e("a",{attrs:{href:"#指标集概览"}},[t._v("指标集概览")])]),e("li",[e("a",{attrs:{href:"#lcp"}},[t._v("LCP")])]),e("li",[e("a",{attrs:{href:"#fid"}},[t._v("FID")])]),e("li",[e("a",{attrs:{href:"#cls"}},[t._v("CLS")])]),e("li",[e("a",{attrs:{href:"#测量工具"}},[t._v("测量工具")])]),e("li",[e("a",{attrs:{href:"#优化步骤"}},[t._v("优化步骤")])]),e("li",[e("a",{attrs:{href:"#参考"}},[t._v("参考")])])])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"指标集概览"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指标集概览"}},[t._v("#")]),t._v(" 指标集概览")]),t._v(" "),e("p",[t._v("核心指标：")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("LCP（Largest Contentful Paint）")]),t._v("：最大内容渲染")]),t._v(" "),e("li",[e("strong",[t._v("FID（First Input Delay）")]),t._v("：首次交互延时")]),t._v(" "),e("li",[e("strong",[t._v("CLS（Cumulative Layout Shift）")]),t._v("：累计布局偏移")])]),t._v(" "),e("blockquote",[e("p",[t._v("其它非核心指标：FCP（FirstContentful）、TTFB（Time to First Bytes）、TBT（Total Blocking Time）、TTI（Time to Interactive）")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://p5.music.126.net/obj/wo3DlcOGw6DClTvDisK1/5300348259/03ed/c3f4/0ee6/4dbce51aa76973c8f2dceeca5d00324d.png",alt:"alt"}})]),t._v(" "),e("h2",{attrs:{id:"lcp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lcp"}},[t._v("#")]),t._v(" LCP")]),t._v(" "),e("p",[t._v("LCP是"),e("strong",[t._v("最大内容渲染")]),t._v("。")]),t._v(" "),e("p",[t._v("指的是"),e("strong",[t._v("当前视窗（viewport）中的最大内容元素的渲染时间。")])]),t._v(" "),e("blockquote",[e("p",[t._v("“内容元素”指的是：image、文字block、Video（poster）、带image的svg")]),t._v(" "),e("p",[t._v("用来衡量“加载时性能（Loading）”。一个快速LCP可以减少用户流失率。")])]),t._v(" "),e("blockquote",[e("p",[t._v("如果一张图片的 “本身像素” 和 “渲染像素” 不同，会取最小值。")])]),t._v(" "),e("h3",{attrs:{id:"重要性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重要性"}},[t._v("#")]),t._v(" 重要性")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("load")]),t._v("、"),e("code",[t._v("DOMContentLoaded")]),t._v("，不一定与 “用户实际看到的现象” 相对应")]),t._v(" "),e("li",[e("code",[t._v("FCP")]),t._v(" 只能捕获到 页面开始渲染的时间（如果一个页面仅仅展示loading，这时间对用户并没有太大作用）")])]),t._v(" "),e("p",[t._v("所以，"),e("strong",[t._v("衡量一个页面的主要内容的加载时间，更准确的应该是测量 “最大内容渲染时间”。")])]),t._v(" "),e("h3",{attrs:{id:"对-元素的尺寸-的判定标准"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#对-元素的尺寸-的判定标准"}},[t._v("#")]),t._v(" 对“元素的尺寸”的判定标准")]),t._v(" "),e("ul",[e("li",[t._v("渲染并对用户可见的")]),t._v(" "),e("li",[t._v("统计尺寸：只统计该元素在视窗中首次渲染的大小（不考虑尺寸/布局变化）")]),t._v(" "),e("li",[t._v("如果当前最大元素在渲染后被移出了，那它仍然是最大的。除非找到更大的")]),t._v(" "),e("li",[t._v("对于溢出：Viewport 内的可见大小（“超出Viewport的不可见部分” 不计）")]),t._v(" "),e("li",[t._v("对于图片：")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 固有尺寸（Intrinsic Size）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实际渲染尺寸（Visible Size）")]),t._v("\nMath"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IntrinsicSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" VisibleSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("ul",[e("li",[t._v("对于文字块：只考虑文本节点的大小")]),t._v(" "),e("li",[t._v("对于 "),e("code",[t._v("margin")]),t._v("、"),e("code",[t._v("padding")]),t._v("、"),e("code",[t._v("border")]),t._v(" 不计")])]),t._v(" "),e("img",{attrs:{src:"https://p6.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7628151137/9104/de54/ff65/1e4a0fdc5b3d6f7db1ef3fe3aa862ccd.png",width:"500px"}}),t._v(" "),e("h3",{attrs:{id:"记录时机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#记录时机"}},[t._v("#")]),t._v(" 记录时机")]),t._v(" "),e("h4",{attrs:{id:"做法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#做法"}},[t._v("#")]),t._v(" 做法")]),t._v(" "),e("p",[t._v("对于一个 “最大内容元素”，会通过 dispatch 一个 "),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry",target:"_blank",rel:"noopener noreferrer"}},[t._v("PerformanceEntry"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("但页面一般是分阶段加载的，所以 “最大内容元素” 可能也会改变。")]),t._v(" "),e("p",[t._v("所以有可能一开始记录的是 “尺寸较小的元素”，随后才渲染“较大的元素”。（这时应该 dispatch 另一个 "),e("code",[t._v("PerformanceEntry")]),t._v("）")]),t._v(" "),e("h4",{attrs:{id:"停止记录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止记录"}},[t._v("#")]),t._v(" 停止记录")]),t._v(" "),e("p",[t._v("当用户开始与页面交互（"),e("code",[t._v("click、tab、scroll、keypress")]),t._v("）时，停止记录。")]),t._v(" "),e("blockquote",[e("p",[t._v("因为用户发生交互，很可能就会改变可见内容")])]),t._v(" "),e("p",[e("strong",[t._v("所以，最终的性能分析报告里，应该只关心最后一个 "),e("code",[t._v("PerformanceEntry")]),t._v("。")])]),t._v(" "),e("blockquote",[e("p",[t._v("如果用户是以 “后台打开Tab的方式” 渲染页面，"),e("strong",[t._v("LCP时间会一直计时")]),t._v("，直到切到这个 tab 时才会上报。")])]),t._v(" "),e("h3",{attrs:{id:"影响因素-优化思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#影响因素-优化思路"}},[t._v("#")]),t._v(" 影响因素 & 优化思路")]),t._v(" "),e("h4",{attrs:{id:"影响因素"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#影响因素"}},[t._v("#")]),t._v(" 影响因素")]),t._v(" "),e("ol",[e("li",[t._v("请求html的服务器响应时间")]),t._v(" "),e("li",[t._v("阻塞渲染的CSS、JavaScript")]),t._v(" "),e("li",[t._v("资源加载时间")]),t._v(" "),e("li",[t._v("客户端渲染（Client-side rending）")])]),t._v(" "),e("h4",{attrs:{id:"优化思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化思路"}},[t._v("#")]),t._v(" 优化思路")]),t._v(" "),e("ol",[e("li",[t._v("PRPL模式(Apply instant loading with the PRPL pattern)")]),t._v(" "),e("li",[t._v("Optimizing the Critical Rendering Path")]),t._v(" "),e("li",[t._v("Optimize your CSS")]),t._v(" "),e("li",[t._v("Optimize your Images")]),t._v(" "),e("li",[t._v("Optimize web Fonts")]),t._v(" "),e("li",[t._v("Optimize your JavaScript (for client-rendered sites)")])]),t._v(" "),e("h4",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://web.dev/lcp/#how-to-improve-lcp",target:"_blank",rel:"noopener noreferrer"}},[t._v("how-to-improve-lcp"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://web.dev/optimize-lcp/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Optimize LCP"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"测量标准"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测量标准"}},[t._v("#")]),t._v(" 测量标准")]),t._v(" "),e("p",[t._v("满足 “大多数用户” 在页面开始加载的前 "),e("code",[t._v("2.5s")]),t._v(" 内，为 "),e("strong",[t._v("优秀")])]),t._v(" "),e("blockquote",[e("p",[t._v("“大多数”的阈值是 75%")])]),t._v(" "),e("img",{attrs:{src:"https://web.dev/vitals/lcp_8x2.svg",width:"420px"}}),t._v(" "),e("h3",{attrs:{id:"测量工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测量工具"}},[t._v("#")]),t._v(" 测量工具")]),t._v(" "),e("h4",{attrs:{id:"真实环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#真实环境"}},[t._v("#")]),t._v(" 真实环境")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("web-vitals")]),t._v(" 库")])]),t._v(" "),e("p",[t._v("Chrome User Experience Report\nPageSpeed Insights\nSearch Console (Core Web Vitals report)\nweb-vitals JavaScript library")]),t._v(" "),e("h4",{attrs:{id:"实验室环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实验室环境"}},[t._v("#")]),t._v(" 实验室环境")]),t._v(" "),e("ul",[e("li",[t._v("Chrome DevTools")]),t._v(" "),e("li",[t._v("Lighthouse")])]),t._v(" "),e("h2",{attrs:{id:"fid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fid"}},[t._v("#")]),t._v(" FID")]),t._v(" "),e("p",[t._v("FID指的是"),e("strong",[t._v("用户首次输入事件的延迟")]),t._v("（注意是"),e("strong",[t._v("首次")]),t._v("）。")]),t._v(" "),e("blockquote",[e("p",[t._v("用来衡量“可交互性（Interactivity）”")])]),t._v(" "),e("h3",{attrs:{id:"判定范围"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#判定范围"}},[t._v("#")]),t._v(" 判定范围")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("click")])]),t._v(" "),e("li",[e("code",[t._v("tap")])]),t._v(" "),e("li",[e("code",[t._v("key press")])])]),t._v(" "),e("p",[t._v("不依赖事件处理器，但需要主线程空闲的"),e("strong",[t._v("也算")]),t._v("：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("checkbox")])]),t._v(" "),e("li",[e("code",[t._v("radio")])]),t._v(" "),e("li",[e("code",[t._v("select")])]),t._v(" "),e("li",[e("code",[t._v("text")])]),t._v(" "),e("li",[e("code",[t._v("link")])])]),t._v(" "),e("blockquote",[e("p",[t._v("不算："),e("code",[t._v("scrolling")]),t._v("、"),e("code",[t._v("zooming")])])]),t._v(" "),e("h3",{attrs:{id:"影响因素-优化思路-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#影响因素-优化思路-2"}},[t._v("#")]),t._v(" 影响因素 & 优化思路")]),t._v(" "),e("p",[e("strong",[t._v("影响因素：")])]),t._v(" "),e("p",[t._v("解析、执行了太重的JavaScript，导致主线程繁忙。")]),t._v(" "),e("p",[e("strong",[t._v("优化思路：")])]),t._v(" "),e("ol",[e("li",[t._v("减少JS文件体积（Code-splitting、延迟加载）")]),t._v(" "),e("li",[t._v("减少主线程执行开销（拆分Long Tasks、异步执行、web worker）")])]),t._v(" "),e("h2",{attrs:{id:"cls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cls"}},[t._v("#")]),t._v(" CLS")]),t._v(" "),e("p",[t._v("CLS指的是"),e("strong",[t._v("累积页面布局偏移")]),t._v("。")]),t._v(" "),e("blockquote",[e("p",[t._v("用来衡量“视觉稳定性（Visual Stability）”")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("布局位移评分 = 影响面积分数 * 距离分数\n\n# “影响面积分数” = （移动前 U 移动后） / 视窗面积\n# “距离分数” = 移动的最大距离 / 视窗的长边\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h3",{attrs:{id:"影响因素-优化思路-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#影响因素-优化思路-3"}},[t._v("#")]),t._v(" 影响因素 & 优化思路")]),t._v(" "),e("ol",[e("li",[t._v("添加元素大小属性（width、height）")]),t._v(" "),e("li",[t._v("不要在已有内容上方插入新的内容")]),t._v(" "),e("li",[t._v("使用不影响布局的动画（transform、animation）")]),t._v(" "),e("li",[t._v("可以适当选择绝对定位")])]),t._v(" "),e("h2",{attrs:{id:"测量工具-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测量工具-2"}},[t._v("#")]),t._v(" 测量工具")]),t._v(" "),e("ul",[e("li",[t._v("Chrome Devtools-Performance\n"),e("ul",[e("li",[t._v("LCP、CLS、Longtask、TBT（Total blocking time）")])])]),t._v(" "),e("li",[t._v("Chrome Devtools-Lighthouse")]),t._v(" "),e("li",[t._v("Chrome插件：Web Vitals")]),t._v(" "),e("li",[t._v("Npm包：web-vitals\n"),e("ul",[e("li",[t._v("在项目内导出并执行getCLS、getFID、getLCP")])])])]),t._v(" "),e("h2",{attrs:{id:"优化步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化步骤"}},[t._v("#")]),t._v(" 优化步骤")]),t._v(" "),e("p",[t._v("“线上真实数据”、“Lighthouse”、“devtools”三者的关系")]),t._v(" "),e("ol",[e("li",[t._v("通过 "),e("strong",[t._v("线上真实数据")]),t._v(" 发现不合格的体验问题")]),t._v(" "),e("li",[t._v("使用 "),e("strong",[t._v("Lighthouse")]),t._v(" 工具诊断，根据优化建议进行优化")]),t._v(" "),e("li",[t._v("结合 "),e("strong",[t._v("devtools")]),t._v(" 等工具进行优化")]),t._v(" "),e("li",[t._v("使用 "),e("strong",[t._v("Lighthouse")]),t._v(" 验证改进效果")]),t._v(" "),e("li",[t._v("通过 "),e("strong",[t._v("线上真实数据")]),t._v(" 验证改进结果")])]),t._v(" "),e("h2",{attrs:{id:"参考-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考-2"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://web.dev/lcp/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Largest Contentful Paint (LCP)"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=s.exports}}]);