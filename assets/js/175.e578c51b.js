(window.webpackJsonp=window.webpackJsonp||[]).push([[175],{720:function(t,a,e){"use strict";e.r(a);var s=e(43),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"web性能优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web性能优化"}},[t._v("#")]),t._v(" Web性能优化")]),t._v(" "),e("blockquote",[e("p",[t._v("根据业务情况，定义Web性能指标。然后 选取数据参考点、收集数据 ，随后分析每个关键指标反映的数据，最后采取优化手段。")])]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#web性能优化"}},[t._v("Web性能优化")]),e("ul",[e("li",[e("a",{attrs:{href:"#指标定义"}},[t._v("指标定义")])]),e("li",[e("a",{attrs:{href:"#指标收集"}},[t._v("指标收集")])]),e("li",[e("a",{attrs:{href:"#首屏优化"}},[t._v("首屏优化")])]),e("li",[e("a",{attrs:{href:"#延迟加载"}},[t._v("延迟加载")])]),e("li",[e("a",{attrs:{href:"#预加载的实现"}},[t._v("预加载的实现")])]),e("li",[e("a",{attrs:{href:"#参考链接"}},[t._v("参考链接")])])])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"指标定义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指标定义"}},[t._v("#")]),t._v(" 指标定义")]),t._v(" "),e("p",[e("strong",[t._v("性能指标")]),t._v(" 一般会关注 2 个层面："),e("strong",[t._v("Web-Vitals、重要时间指标")]),t._v("。")]),t._v(" "),e("h3",{attrs:{id:"web-vitals"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-vitals"}},[t._v("#")]),t._v(" Web-Vitals")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("LCP（Largest Contentful Paint）")]),t._v("：最大内容渲染\n"),e("ul",[e("li",[t._v("75% 用户小于 2 秒")])])]),t._v(" "),e("li",[e("strong",[t._v("FCP（First Contentful Paint）")]),t._v("：首个内容渲染时间（即 “白屏时间”）\n"),e("ul",[e("li",[t._v("75% 用户小于 1 秒")])])]),t._v(" "),e("li",[e("strong",[t._v("FID（First Input Delay）")]),t._v("：首次交互延时\n"),e("ul",[e("li",[t._v("75% 用户小于 100毫秒")])])]),t._v(" "),e("li",[e("strong",[t._v("CLS（Cumulative Layout Shift）")]),t._v("：累计布局偏移\n"),e("ul",[e("li",[t._v("75% 用户小于 0.1")])])])]),t._v(" "),e("h3",{attrs:{id:"时间指标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时间指标"}},[t._v("#")]),t._v(" 时间指标")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("白屏时间")]),t._v("：开始解析渲染DOM的时间（即："),e("code",[t._v("FCP")]),t._v("）\n"),e("ul",[e("li",[e("strong",[t._v("domLoading - fetchStart")])])])]),t._v(" "),e("li",[e("strong",[t._v("首屏时间")]),t._v("：“第一屏内容” 渲染完成的时间\n"),e("ul",[e("li",[e("strong",[t._v("第一屏最后一个内容 - fetchStart")])])])]),t._v(" "),e("li",[e("strong",[t._v("用户可操作时间")]),t._v("：用户可操作时间（即 "),e("code",[t._v("DomReady")]),t._v("）\n"),e("ul",[e("li",[e("strong",[t._v("domContentLoadedEventEnd - fetchStart")])])])]),t._v(" "),e("li",[e("strong",[t._v("页面完全加载时间")]),t._v("：页面所有资源加载完成时间（ "),e("code",[t._v("load")]),t._v(" 事件触发，也叫 “总下载时间” ）\n"),e("ul",[e("li",[e("strong",[t._v("loadEventStart - fetchStart")])])])])]),t._v(" "),e("h2",{attrs:{id:"指标收集"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指标收集"}},[t._v("#")]),t._v(" 指标收集")]),t._v(" "),e("p",[t._v("有两个方式可以收集到指标数据："),e("strong",[t._v("window.performance.timing、web-vitals")])]),t._v(" "),e("h3",{attrs:{id:"window-performance-timing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#window-performance-timing"}},[t._v("#")]),t._v(" window.performance.timing")]),t._v(" "),e("p",[e("code",[t._v("window.performance.timing")]),t._v(" 可以获取 "),e("strong",[t._v("页面渲染过程中，各个时间段的时间戳")]),t._v("。")]),t._v(" "),e("img",{attrs:{src:"https://p6.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7801768838/15e1/ad4f/1047/69fbc1fd74e514fa9618588aa5319d96.png",width:"700px"}}),t._v(" "),e("p",[t._v("几个重要的时间属性：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("navigationSart")]),t._v("：上一个文档 "),e("code",[t._v("unload")]),t._v(" 的时刻（若上一个文档为空，值为"),e("code",[t._v("fetchStart")]),t._v("）")]),t._v(" "),e("li",[e("code",[t._v("fetchStart")]),t._v("：浏览器请求文档 就绪 的时刻（下一步是检查缓存之前）")]),t._v(" "),e("li",[e("code",[t._v("domLoading")]),t._v("："),e("strong",[t._v("开始解析DOM")]),t._v(" 的时刻")]),t._v(" "),e("li",[e("code",[t._v("domContentLoadedEventEnd")]),t._v("："),e("strong",[t._v("DOM解析完成")]),t._v(" 的时刻（即：触发 "),e("code",[t._v("DOMContentLoaded")]),t._v(" 事件）")]),t._v(" "),e("li",[e("code",[t._v("loadEventStart")]),t._v("："),e("strong",[e("code",[t._v("load")]),t._v(" 事件触发")]),t._v(" 的时刻")]),t._v(" "),e("li",[e("code",[t._v("loadEventEnd")]),t._v("："),e("strong",[e("code",[t._v("load")]),t._v("事件结束")]),t._v(" 的时刻")])]),t._v(" "),e("blockquote",[e("p",[t._v("DOMContentLoaded：页面元素加载完毕，"),e("strong",[t._v("可正常交互")]),t._v("。"),e("strong",[t._v("但图片资源可能还未加载完成")]),t._v("；")]),t._v(" "),e("p",[t._v("load：指页面上 "),e("strong",[t._v("所有资源 都加载完成")]),t._v("。")])]),t._v(" "),e("h3",{attrs:{id:"web-vitals-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-vitals-2"}},[t._v("#")]),t._v(" web-vitals")]),t._v(" "),e("p",[e("code",[t._v("Web-Vitals")]),t._v(" 底层是通过拿到 "),e("code",[t._v("PerformanceEntry")]),t._v("（性能数据的实例） 然后进行分析。")]),t._v(" "),e("blockquote",[e("p",[t._v("如LCP：浏览器 会通过发送一个 "),e("code",[t._v("PerformanceEntry")]),t._v("（"),e("code",[t._v("type")]),t._v(" 为 "),e("code",[t._v("largest-contentful-paint")]),t._v("）来标识最大的内容元素。")])]),t._v(" "),e("h2",{attrs:{id:"首屏优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#首屏优化"}},[t._v("#")]),t._v(" 首屏优化")]),t._v(" "),e("h3",{attrs:{id:"代码层面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码层面"}},[t._v("#")]),t._v(" 代码层面")]),t._v(" "),e("p",[t._v("样式：")]),t._v(" "),e("ul",[e("li",[t._v("图片压缩（webpack tiny）（LCP）")]),t._v(" "),e("li",[t._v("图片懒加载（LCP）")]),t._v(" "),e("li",[t._v("非首屏工具包的css拆包、")]),t._v(" "),e("li",[t._v("preload（CLS）")])]),t._v(" "),e("p",[t._v("JS：")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("代码瘦身、拆包")])]),t._v(" "),e("li",[t._v("延迟加载")])]),t._v(" "),e("p",[t._v("架构：")]),t._v(" "),e("ul",[e("li",[t._v("SSR")])]),t._v(" "),e("h3",{attrs:{id:"缓存层面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缓存层面"}},[t._v("#")]),t._v(" 缓存层面")]),t._v(" "),e("ul",[e("li",[t._v("浏览器缓存（强缓存、协商缓存）")]),t._v(" "),e("li",[t._v("CDN")]),t._v(" "),e("li",[t._v("ServiceWorker")]),t._v(" "),e("li",[e("strong",[t._v("Varnish")]),t._v("：缓存 服务器 返回的结果。当后续有相同的请求，Varnish不会再将这个请求转发到服务器，返回 上次缓存结果")]),t._v(" "),e("li",[t._v("（Hybrid应用）H5离线包")])]),t._v(" "),e("h2",{attrs:{id:"延迟加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#延迟加载"}},[t._v("#")]),t._v(" 延迟加载")]),t._v(" "),e("h3",{attrs:{id:"图片的延迟加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#图片的延迟加载"}},[t._v("#")]),t._v(" 图片的延迟加载")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intersection Observer API"),e("OutboundLink")],1)]),t._v("：异步检测 目标元素 和 父元素（或视窗） 相交的情况。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("scroll")]),t._v(" + "),e("code",[t._v("getBoundingClientReact()")]),t._v("，实时赋值"),e("code",[t._v("src")]),t._v("属性。")])])]),t._v(" "),e("blockquote",[e("p",[t._v("Intersection Observer 注意兼容性。通过 npm包（"),e("code",[t._v("intersection-observer")]),t._v("） 进行polyfill")])]),t._v(" "),e("h2",{attrs:{id:"预加载的实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预加载的实现"}},[t._v("#")]),t._v(" 预加载的实现")]),t._v(" "),e("p",[t._v("原理：将所需资源提前请求加载到本地，这样后面在需要用到时就直接"),e("strong",[t._v("从缓存取资源")]),t._v("。")]),t._v(" "),e("p",[t._v("1、使用"),e("code",[t._v("display: none")])]),t._v(" "),e("p",[t._v("2、使用"),e("code",[t._v("Image")]),t._v("对象")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" image "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nimage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"images.1.png"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("3、"),e("code",[t._v("<link>")]),t._v("的"),e("code",[t._v("preload")])]),t._v(" "),e("div",{staticClass:"language-html line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("test.mp4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("as")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("video"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("video/mp4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("这种方式有资源的类型要求。")]),t._v(" "),e("p",[t._v("和懒加载的区别：预加载是提前加载、懒加载是延迟加载。")]),t._v(" "),e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/skill/web/optimize/TRANDITION.html"}},[t._v("传统性能检测手段")])],1),t._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.im/post/5df4294d518825128306cd5c#comment",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端性能监控方案（首屏、白屏时间等）"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://lz5z.com/Web%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E9%A6%96%E5%B1%8F%E5%92%8C%E7%99%BD%E5%B1%8F%E6%97%B6%E9%97%B4/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 性能优化-首屏和白屏时间"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000011516068",target:"_blank",rel:"noopener noreferrer"}},[t._v("全新Chrome Devtools Performance使用指南"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.im/post/5d63311be51d45620821ced8",target:"_blank",rel:"noopener noreferrer"}},[t._v("React性能优化的8种方式了解一下？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.im/post/5d548b83f265da03ab42471d#heading-2",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue 项目性能优化 — 实践指南（网上最全 / 详细）"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000018275268?utm_source=tag-newest",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端性能优化--懒加载和预加载"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);