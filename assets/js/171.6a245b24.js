(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{716:function(v,e,_){"use strict";_.r(e);var t=_(43),a=Object(t.a)({},(function(){var v=this,e=v.$createElement,_=v._self._c||e;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"jsbridge通信原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge通信原理"}},[v._v("#")]),v._v(" JSBridge通信原理")]),v._v(" "),_("h2",{attrs:{id:"js调用native"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#js调用native"}},[v._v("#")]),v._v(" JS调用Native")]),v._v(" "),_("p",[v._v("JS 调用 Native，有 3 种 通信方法：")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("拦截 Scheme")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("原理：")]),v._v(" “JS侧” 利用 “跳转” 来发起请求，“客户端” 拦截请求，并解析上面的参数。")]),v._v(" "),_("li",[_("strong",[v._v("缺点")]),v._v("：请求可能会丢失。")])]),v._v(" "),_("blockquote",[_("p",[v._v("如：URL 有长度限制；"),_("code",[v._v("WKWebView")]),v._v(" 会限制 “连续跳转” 等原因。")])])]),v._v(" "),_("li",[_("p",[v._v("拦截弹窗")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("原理：")]),v._v(" 弹窗会触发 WebView 相应事件。")]),v._v(" "),_("li",[_("strong",[v._v("缺点：")]),v._v(" "),_("code",[v._v("UIWebView")]),v._v(" 不支持。")])])]),v._v(" "),_("li",[_("p",[v._v("向 JS的上下文 注入对象、方法")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("原理：")]),v._v(" 通过 WebView 向 JS的上下文 注入对象、方法，可以让 JS 直接调用 Native。")])])])]),v._v(" "),_("h3",{attrs:{id:"向-js的上下文-注入对象、方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#向-js的上下文-注入对象、方法"}},[v._v("#")]),v._v(" 向 JS的上下文 注入对象、方法")]),v._v(" "),_("h4",{attrs:{id:"ios"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ios"}},[v._v("#")]),v._v(" iOS")]),v._v(" "),_("h5",{attrs:{id:"uiwebview"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#uiwebview"}},[v._v("#")]),v._v(" UIWebView")]),v._v(" "),_("p",[v._v("特点：兼容 iOS 低版本，同步返回。")]),v._v(" "),_("ol",[_("li",[v._v("获取 JS上下文")]),v._v(" "),_("li",[v._v("注入 Block")])]),v._v(" "),_("h5",{attrs:{id:"wkwebview"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#wkwebview"}},[v._v("#")]),v._v(" WKWebView")]),v._v(" "),_("p",[v._v("特点：iOS8及以上，异步返回。")]),v._v(" "),_("ol",[_("li",[_("p",[v._v("注入对象： "),_("code",[v._v("addScriptMessageHandler")])]),v._v(" "),_("ul",[_("li",[v._v("实际上只有 "),_("code",[v._v("postMessage")]),v._v(" 方法")])])]),v._v(" "),_("li",[_("p",[v._v("接收参数: "),_("code",[v._v("didReceiveScriptMessage")])])]),v._v(" "),_("li",[_("p",[v._v("销毁对象： "),_("code",[v._v("removeScriptMessageHandler")])])])]),v._v(" "),_("h4",{attrs:{id:"android"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#android"}},[v._v("#")]),v._v(" Android")]),v._v(" "),_("ul",[_("li",[v._v("注入对象： 通过注解 "),_("code",[v._v("@JavascriptInterface")])])]),v._v(" "),_("h2",{attrs:{id:"native调用js"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#native调用js"}},[v._v("#")]),v._v(" Native调用JS")]),v._v(" "),_("p",[v._v("一般直接执行JS代码字符串。")]),v._v(" "),_("p",[v._v("注意："),_("strong",[v._v("客户端只能调用挂载到 "),_("code",[v._v("window")]),v._v(" 对象上的方法")]),v._v("。")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("iOS")]),v._v(" "),_("ul",[_("li",[v._v("UIWebView： "),_("code",[v._v("stringByEvaluatingJavaScriptFromString")])]),v._v(" "),_("li",[v._v("WKWebView： "),_("code",[v._v("evaluateJavaScript")])])])]),v._v(" "),_("li",[_("p",[v._v("Android：")]),v._v(" "),_("ul",[_("li",[v._v("4.4以上："),_("code",[v._v("evaluateJavascript")])]),v._v(" "),_("li",[v._v("4.4及以下： "),_("code",[v._v("loadUrl")])])])])]),v._v(" "),_("h2",{attrs:{id:"jsbridge通信"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge通信"}},[v._v("#")]),v._v(" JSBridge通信")]),v._v(" "),_("p",[v._v("基于 "),_("code",[v._v("WebViewJavascriptBridge")]),v._v(" 实现。")]),v._v(" "),_("p",[v._v("它结合了 "),_("strong",[v._v("Scheme协议 + 向JS上下文注入对象/方法")]),v._v("。")]),v._v(" "),_("img",{attrs:{src:"https://p5.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7738019941/98ac/8b08/f7db/c6c0c0fcf626b529a2db479a8bde34e5.png",width:"400px"}}),v._v(" "),_("h2",{attrs:{id:"其他"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[v._v("#")]),v._v(" 其他")]),v._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[v._v("TIP")]),v._v(" "),_("p",[v._v("背景")]),v._v(" "),_("h4",{attrs:{id:"scheme注册"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#scheme注册"}},[v._v("#")]),v._v(" Scheme注册")]),v._v(" "),_("p",[v._v("App 安装后会在手机系统上注册一个 "),_("code",[v._v("Scheme")]),v._v("（比如："),_("code",[v._v("weixin://")]),v._v("、"),_("code",[v._v("orpheus://")]),v._v("）。所以在浏览器里访问这个 scheme 地址，系统就会唤起App")]),v._v(" "),_("h4",{attrs:{id:"ios里webview的种类"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ios里webview的种类"}},[v._v("#")]),v._v(" iOS里WebView的种类")]),v._v(" "),_("p",[v._v("iOS 里有 2 种 WebView："),_("code",[v._v("UIWebView")]),v._v("、"),_("code",[v._v("WKWebView")]),v._v("。")]),v._v(" "),_("p",[v._v("其中， "),_("code",[v._v("WKWebView")]),v._v(" 是 iOS8 之后出现的")]),v._v(" "),_("ul",[_("li",[v._v("优点：占用内存更少，能够更好地支持 HTML5，性能更强大")]),v._v(" "),_("li",[v._v("缺点：不支持缓存、需要自己注入Cookie、拦截 Post 请求时无法解析参数")])])])])}),[],!1,null,null,null);e.default=a.exports}}]);